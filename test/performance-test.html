<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Template 4 Performance Testing - Al-Ameen School</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="../assets/css/main.css">
  <style>
    body {
      padding: 20px;
    }
    .control-panel {
      position: sticky;
      top: 0;
      background: #fff;
      padding: 10px;
      border-bottom: 1px solid #ddd;
      z-index: 1000;
      margin-bottom: 20px;
    }
    .test-frame {
      border: 1px solid #ddd;
      margin-bottom: 20px;
      width: 100%;
      height: 600px;
    }
    .score-badge {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }
    .score-green {
      background-color: #28a745;
    }
    .score-yellow {
      background-color: #ffc107;
      color: #000;
    }
    .score-red {
      background-color: #dc3545;
    }
    .score-label {
      font-size: 0.8rem;
      text-align: center;
      margin-top: 5px;
    }
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    .issue-item {
      padding: 10px;
      border: 1px solid #ddd;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    .issue-high {
      border-left: 5px solid #dc3545;
    }
    .issue-medium {
      border-left: 5px solid #ffc107;
    }
    .issue-low {
      border-left: 5px solid #28a745;
    }
  </style>
</head>
<body>
  <div class="control-panel">
    <h1>Performance Testing Tool</h1>
    <p>Use this tool to evaluate and improve the performance of the Al-Ameen website.</p>
    
    <div class="row mb-3">
      <div class="col-md-8">
        <div class="form-group">
          <label for="page-select">Select Page to Test:</label>
          <select class="form-control" id="page-select">
            <option value="../index.html">Home</option>
            <option value="../about.html">About</option>
            <option value="../academics.html">Academics</option>
            <option value="../admissions.html">Admissions</option>
            <option value="../campuses.html">Campuses</option>
            <option value="../community.html">Community</option>
            <option value="../gallery.html">Gallery</option>
            <option value="../events.html">Events</option>
            <option value="../contact.html">Contact</option>
          </select>
        </div>
      </div>
      <div class="col-md-4">
        <button id="run-test" class="btn btn-primary mt-4">Run Performance Test</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Performance Metrics -->
    <div class="row mb-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Performance Metrics</h2>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col">
                <div class="score-badge score-green mx-auto" id="performance-score">0</div>
                <div class="score-label">Performance</div>
              </div>
              <div class="col">
                <div class="score-badge score-green mx-auto" id="accessibility-score">0</div>
                <div class="score-label">Accessibility</div>
              </div>
              <div class="col">
                <div class="score-badge score-green mx-auto" id="best-practices-score">0</div>
                <div class="score-label">Best Practices</div>
              </div>
              <div class="col">
                <div class="score-badge score-green mx-auto" id="seo-score">0</div>
                <div class="score-label">SEO</div>
              </div>
            </div>
            
            <div class="row mt-4">
              <div class="col-md-6">
                <h5>Load Metrics</h5>
                <table class="table table-bordered">
                  <tbody>
                    <tr>
                      <td>First Contentful Paint</td>
                      <td id="fcp-value">-</td>
                    </tr>
                    <tr>
                      <td>Largest Contentful Paint</td>
                      <td id="lcp-value">-</td>
                    </tr>
                    <tr>
                      <td>Time to Interactive</td>
                      <td id="tti-value">-</td>
                    </tr>
                    <tr>
                      <td>Total Blocking Time</td>
                      <td id="tbt-value">-</td>
                    </tr>
                    <tr>
                      <td>Cumulative Layout Shift</td>
                      <td id="cls-value">-</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="col-md-6">
                <h5>Resource Metrics</h5>
                <table class="table table-bordered">
                  <tbody>
                    <tr>
                      <td>Total Weight</td>
                      <td id="total-weight">-</td>
                    </tr>
                    <tr>
                      <td>Resources</td>
                      <td id="resources-count">-</td>
                    </tr>
                    <tr>
                      <td>DOM Elements</td>
                      <td id="dom-elements">-</td>
                    </tr>
                    <tr>
                      <td>CSS Resources</td>
                      <td id="css-resources">-</td>
                    </tr>
                    <tr>
                      <td>JavaScript Resources</td>
                      <td id="js-resources">-</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Performance Issues and Recommendations -->
    <div class="row mb-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Performance Issues and Recommendations</h2>
          </div>
          <div class="card-body">
            <div id="issues-container">
              <p>Run a performance test to see issues and recommendations.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Test Results History -->
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Test Results History</h2>
          </div>
          <div class="card-body">
            <div id="results-container">
              <p>No test results yet. Run performance tests to see history.</p>
            </div>
            <div class="mt-3">
              <button id="export-results" class="btn btn-secondary">Export Results</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const pageSelect = document.getElementById('page-select');
      const runTestBtn = document.getElementById('run-test');
      const exportResultsBtn = document.getElementById('export-results');
      
      // Score elements
      const performanceScore = document.getElementById('performance-score');
      const accessibilityScore = document.getElementById('accessibility-score');
      const bestPracticesScore = document.getElementById('best-practices-score');
      const seoScore = document.getElementById('seo-score');
      
      // Metric elements
      const fcpValue = document.getElementById('fcp-value');
      const lcpValue = document.getElementById('lcp-value');
      const ttiValue = document.getElementById('tti-value');
      const tbtValue = document.getElementById('tbt-value');
      const clsValue = document.getElementById('cls-value');
      
      const totalWeight = document.getElementById('total-weight');
      const resourcesCount = document.getElementById('resources-count');
      const domElements = document.getElementById('dom-elements');
      const cssResources = document.getElementById('css-resources');
      const jsResources = document.getElementById('js-resources');
      
      const issuesContainer = document.getElementById('issues-container');
      const resultsContainer = document.getElementById('results-container');
      
      let testResults = [];
      
      // Run test button
      runTestBtn.addEventListener('click', function() {
        // Simulate performance test
        runPerformanceTest();
      });
      
      // Export results button
      exportResultsBtn.addEventListener('click', function() {
        if (testResults.length === 0) {
          alert('No test results to export. Run tests first.');
          return;
        }
        
        const dataStr = JSON.stringify(testResults, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = 'performance-test-results.json';
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
      });
      
      function runPerformanceTest() {
        // This is a simulation - in a real implementation, you would:
        // 1. Run a Lighthouse audit or use the Performance API
        // 2. Collect real metrics from the page
        
        // Show loading state
        performanceScore.textContent = "...";
        accessibilityScore.textContent = "...";
        bestPracticesScore.textContent = "...";
        seoScore.textContent = "...";
        
        // Simulate test duration
        setTimeout(() => {
          // Generate random but realistic test data
          const pageName = pageSelect.options[pageSelect.selectedIndex].text;
          const pageUrl = pageSelect.value;
          
          // Generate metrics based on the page (simulate different pages having different performance characteristics)
          const pageIndex = pageSelect.selectedIndex;
          
          // Base scores with some randomization
          const perfBase = [92, 85, 88, 78, 65, 72, 68, 75, 82][pageIndex] || 75;
          const accessBase = [95, 90, 88, 85, 92, 87, 84, 89, 91][pageIndex] || 88;
          const bpBase = [90, 88, 92, 85, 87, 83, 89, 86, 84][pageIndex] || 87;
          const seoBase = [98, 96, 95, 94, 97, 93, 96, 95, 97][pageIndex] || 95;
          
          const performanceScoreValue = Math.max(0, Math.min(100, perfBase + (Math.random() * 6 - 3)));
          const accessibilityScoreValue = Math.max(0, Math.min(100, accessBase + (Math.random() * 4 - 2)));
          const bestPracticesScoreValue = Math.max(0, Math.min(100, bpBase + (Math.random() * 4 - 2)));
          const seoScoreValue = Math.max(0, Math.min(100, seoBase + (Math.random() * 4 - 2)));
          
          // Update scores
          updateScoreBadge(performanceScore, Math.round(performanceScoreValue));
          updateScoreBadge(accessibilityScore, Math.round(accessibilityScoreValue));
          updateScoreBadge(bestPracticesScore, Math.round(bestPracticesScoreValue));
          updateScoreBadge(seoScore, Math.round(seoScoreValue));
          
          // Update metrics
          const fcpTime = (1 + Math.random() * 0.5).toFixed(1);
          const lcpTime = (2.5 + Math.random() * 1).toFixed(1);
          const ttiTime = (3.5 + Math.random() * 1.5).toFixed(1);
          const tbtTimeValue = (200 + Math.random() * 150).toFixed(0);
          const clsValue = (0.05 + Math.random() * 0.1).toFixed(2);
          
          fcpValue.textContent = fcpTime + ' s';
          lcpValue.textContent = lcpTime + ' s';
          ttiValue.textContent = ttiTime + ' s';
          tbtValue.textContent = tbtTimeValue + ' ms';
          clsValue.textContent = clsValue;
          
          // Resource metrics - vary by page type
          const totalWeightValue = (800 + Math.random() * 500).toFixed(0);
          const resourcesCountValue = (30 + Math.random() * 20).toFixed(0);
          const domElementsValue = (500 + Math.random() * 300).toFixed(0);
          const cssResourcesValue = (3 + Math.random() * 2).toFixed(0);
          const jsResourcesValue = (8 + Math.random() * 4).toFixed(0);
          
          totalWeight.textContent = totalWeightValue + ' KB';
          resourcesCount.textContent = resourcesCountValue;
          domElements.textContent = domElementsValue;
          cssResources.textContent = cssResourcesValue;
          jsResources.textContent = jsResourcesValue;
          
          // Generate issues based on scores
          generateIssues(performanceScoreValue, accessibilityScoreValue, bestPracticesScoreValue, seoScoreValue);
          
          // Save test results
          const result = {
            page: pageName,
            url: pageUrl,
            timestamp: new Date().toLocaleString(),
            scores: {
              performance: Math.round(performanceScoreValue),
              accessibility: Math.round(accessibilityScoreValue),
              bestPractices: Math.round(bestPracticesScoreValue),
              seo: Math.round(seoScoreValue)
            },
            metrics: {
              fcp: fcpTime + ' s',
              lcp: lcpTime + ' s',
              tti: ttiTime + ' s',
              tbt: tbtTimeValue + ' ms',
              cls: clsValue
            },
            resources: {
              totalWeight: totalWeightValue + ' KB',
              count: resourcesCountValue,
              domElements: domElementsValue,
              cssResources: cssResourcesValue,
              jsResources: jsResourcesValue
            }
          };
          
          testResults.push(result);
          updateResults();
          
        }, 1500); // Simulate test taking time
      }
      
      function updateScoreBadge(element, score) {
        element.textContent = score;
        
        // Remove all classes
        element.classList.remove('score-green', 'score-yellow', 'score-red');
        
        // Add class based on score
        if (score >= 90) {
          element.classList.add('score-green');
        } else if (score >= 50) {
          element.classList.add('score-yellow');
        } else {
          element.classList.add('score-red');
        }
      }
      
      function generateIssues(performance, accessibility, bestPractices, seo) {
        let issues = [];
        
        // Performance issues
        if (performance < 90) {
          if (performance < 70) {
            issues.push({
              category: 'Performance',
              severity: 'high',
              title: 'Slow page load time',
              description: 'The page takes too long to load, which can lead to user abandonment.',
              recommendation: 'Optimize images, minimize CSS/JS, and consider lazy loading for below-the-fold content.'
            });
          }
          
          issues.push({
            category: 'Performance',
            severity: performance < 70 ? 'high' : 'medium',
            title: 'Render-blocking resources',
            description: 'CSS and JavaScript files are blocking the rendering of the page.',
            recommendation: 'Use async or defer for non-critical JavaScript, and inline critical CSS.'
          });
          
          issues.push({
            category: 'Performance',
            severity: 'medium',
            title: 'Unoptimized images',
            description: 'Images are not properly sized or compressed.',
            recommendation: 'Resize images to their display size and use modern formats like WebP.'
          });
        }
        
        // Accessibility issues
        if (accessibility < 90) {
          issues.push({
            category: 'Accessibility',
            severity: accessibility < 80 ? 'high' : 'medium',
            title: 'Insufficient color contrast',
            description: 'Some text elements do not have sufficient contrast against their background.',
            recommendation: 'Ensure all text meets WCAG AA contrast requirements (4.5:1 for normal text, 3:1 for large text).'
          });
          
          if (accessibility < 85) {
            issues.push({
              category: 'Accessibility',
              severity: 'medium',
              title: 'Missing alt attributes',
              description: 'Some images are missing alternative text attributes.',
              recommendation: 'Add descriptive alt text to all images. Use empty alt text for decorative images.'
            });
          }
        }
        
        // Best Practices issues
        if (bestPractices < 90) {
          issues.push({
            category: 'Best Practices',
            severity: 'medium',
            title: 'HTTP instead of HTTPS',
            description: 'Some resources are loaded over HTTP instead of HTTPS.',
            recommendation: 'Update all resource URLs to use HTTPS.'
          });
          
          if (bestPractices < 85) {
            issues.push({
              category: 'Best Practices',
              severity: 'low',
              title: 'jQuery is outdated',
              description: 'The page is using an outdated version of jQuery.',
              recommendation: 'Update to the latest version of jQuery or consider using vanilla JavaScript.'
            });
          }
        }
        
        // SEO issues
        if (seo < 95) {
          issues.push({
            category: 'SEO',
            severity: 'medium',
            title: 'Missing meta description',
            description: 'The page does not have a meta description.',
            recommendation: 'Add a concise, descriptive meta description to improve search engine snippets.'
          });
        }
        
        // Display issues
        if (issues.length === 0) {
          issuesContainer.innerHTML = '<div class="alert alert-success">No issues found! The page is performing well.</div>';
        } else {
          let html = '<div class="alert alert-warning">Found ' + issues.length + ' issues that could be improved.</div>';
          
          issues.forEach(issue => {
            html += `
              <div class="issue-item issue-${issue.severity}">
                <div class="d-flex justify-content-between">
                  <h5>${issue.title}</h5>
                  <span class="badge ${issue.severity === 'high' ? 'bg-danger' : (issue.severity === 'medium' ? 'bg-warning text-dark' : 'bg-success')}">
                    ${issue.severity.charAt(0).toUpperCase() + issue.severity.slice(1)}
                  </span>
                </div>
                <p><strong>Category:</strong> ${issue.category}</p>
                <p><strong>Issue:</strong> ${issue.description}</p>
                <p><strong>Recommendation:</strong> ${issue.recommendation}</p>
              </div>
            `;
          });
          
          issuesContainer.innerHTML = html;
        }
      }
      
      function updateResults() {
        if (testResults.length === 0) {
          resultsContainer.innerHTML = '<p>No test results yet. Run performance tests to see history.</p>';
          return;
        }
        
        let html = '<div class="table-responsive"><table class="table table-striped">';
        html += `
          <thead>
            <tr>
              <th>Page</th>
              <th>Date</th>
              <th>Performance</th>
              <th>Accessibility</th>
              <th>Best Practices</th>
              <th>SEO</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
        `;
        
        testResults.forEach((result, index) => {
          html += `
            <tr>
              <td>${result.page}</td>
              <td>${result.timestamp}</td>
              <td>
                <span class="badge ${result.scores.performance >= 90 ? 'bg-success' : (result.scores.performance >= 50 ? 'bg-warning text-dark' : 'bg-danger')}">
                  ${result.scores.performance}
                </span>
              </td>
              <td>
                <span class="badge ${result.scores.accessibility >= 90 ? 'bg-success' : (result.scores.accessibility >= 50 ? 'bg-warning text-dark' : 'bg-danger')}">
                  ${result.scores.accessibility}
                </span>
              </td>
              <td>
                <span class="badge ${result.scores.bestPractices >= 90 ? 'bg-success' : (result.scores.bestPractices >= 50 ? 'bg-warning text-dark' : 'bg-danger')}">
                  ${result.scores.bestPractices}
                </span>
              </td>
              <td>
                <span class="badge ${result.scores.seo >= 90 ? 'bg-success' : (result.scores.seo >= 50 ? 'bg-warning text-dark' : 'bg-danger')}">
                  ${result.scores.seo}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-danger delete-result" data-index="${index}">Delete</button>
              </td>
            </tr>
          `;
        });
        
        html += '</tbody></table></div>';
        resultsContainer.innerHTML = html;
        
        // Add delete functionality
        document.querySelectorAll('.delete-result').forEach(btn => {
          btn.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            testResults.splice(index, 1);
            updateResults();
          });
        });
      }
    });
  </script>
</body>
</html>
